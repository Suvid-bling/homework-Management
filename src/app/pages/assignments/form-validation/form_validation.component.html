<!-- form_validation.component.html -->
<div class="form-validation-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <div class="page-header">
    <h1 class="page-title">
      <span class="title-icon">ğŸ“</span>
      è¡¨å•éªŒè¯æ¼”ç¤º
    </h1>
    <p class="page-description">
      å±•ç¤ºAngularè¡¨å•éªŒè¯çš„å®Œæ•´åŠŸèƒ½ï¼ŒåŒ…æ‹¬å“åº”å¼è¡¨å•å’Œæ¨¡æ¿é©±åŠ¨è¡¨å•çš„å„ç§éªŒè¯æ–¹å¼ã€
      è‡ªå®šä¹‰éªŒè¯å™¨ã€å¼‚æ­¥éªŒè¯ã€æ¡ä»¶éªŒè¯ç­‰é«˜çº§ç‰¹æ€§ã€‚
    </p>
  </div>

  <!-- éªŒè¯ç»Ÿè®¡å¡ç‰‡ -->
  <div class="stats-card">
    <h3>ğŸ“Š è¡¨å•éªŒè¯ç»Ÿè®¡</h3>
    <div class="stats-grid">
      <div class="stat-item stat-valid">
        <div class="stat-value">{{ validationStats.reactive.valid }}</div>
        <div class="stat-label">æœ‰æ•ˆå­—æ®µ</div>
      </div>
      <div class="stat-item stat-invalid">
        <div class="stat-value">{{ validationStats.reactive.invalid }}</div>
        <div class="stat-label">æ— æ•ˆå­—æ®µ</div>
      </div>
      <div class="stat-item stat-pending">
        <div class="stat-value">{{ validationStats.reactive.pending }}</div>
        <div class="stat-label">éªŒè¯ä¸­</div>
      </div>
      <div class="stat-item stat-completion">
        <div class="stat-value">{{ getFormCompletionPercentage() }}%</div>
        <div class="stat-label">å®Œæˆåº¦</div>
      </div>
    </div>
  </div>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <div class="tabs-container">
    <div class="tab-nav">
      <button 
        class="tab-button"
        [class.active]="activeTab === 'reactive'"
        (click)="switchTab('reactive')">
        ğŸ›ï¸ å“åº”å¼è¡¨å•éªŒè¯
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'template'"
        (click)="switchTab('template')">
        ğŸ“‹ æ¨¡æ¿é©±åŠ¨è¡¨å•éªŒè¯
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'theory'"
        (click)="switchTab('theory')">
        ğŸ“š éªŒè¯ç†è®ºä¸æœ€ä½³å®è·µ
      </button>
    </div>

    <!-- å“åº”å¼è¡¨å•æ ‡ç­¾é¡µ -->
    <div class="tab-content" *ngIf="activeTab === 'reactive'">
      <div class="form-container">
        <!-- è¡¨å•è¿›åº¦æ¡ -->
        <div class="form-progress">
          <div class="progress-info">
            <span>è¡¨å•å®Œæˆè¿›åº¦: {{ getFormCompletionPercentage() }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getFormCompletionPercentage()"></div>
          </div>
        </div>

        <form [formGroup]="studentForm" (ngSubmit)="onSubmitReactiveForm()" class="reactive-form">
          <!-- ä¸ªäººä¿¡æ¯éƒ¨åˆ† -->
          <div class="form-section">
            <div class="section-header">
              <h3>ğŸ‘¤ ä¸ªäººä¿¡æ¯</h3>
              <div class="section-status" [class.valid]="studentForm.get('personalInfo')?.valid">
                {{ studentForm.get('personalInfo')?.valid ? 'âœ…' : 'âŒ' }}
              </div>
            </div>

            <div formGroupName="personalInfo" class="form-group-container">
              <div class="form-grid">
                <!-- å§“å -->
                <div class="form-field">
                  <label class="field-label required">å§“å</label>
                  <input 
                    type="text"
                    formControlName="name"
                    class="form-input"
                    [class.error]="hasError('personalInfo.name')"
                    placeholder="è¯·è¾“å…¥çœŸå®å§“å">
                  <div class="field-error" *ngIf="hasError('personalInfo.name')">
                    {{ getErrorMessage('personalInfo.name') }}
                  </div>
                </div>

                <!-- é‚®ç®± -->
                <div class="form-field">
                  <label class="field-label required">é‚®ç®±</label>
                  <div class="input-with-status">
                    <input 
                      type="email"
                      formControlName="email"
                      class="form-input"
                      [class.error]="hasError('personalInfo.email')"
                      [class.pending]="getFormControl('personalInfo.email')?.pending"
                      placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€">
                    <div class="input-status">
                      <span *ngIf="getFormControl('personalInfo.email')?.pending" class="status-pending">â³</span>
                      <span *ngIf="getFormControl('personalInfo.email')?.valid" class="status-valid">âœ…</span>
                      <span *ngIf="hasError('personalInfo.email')" class="status-error">âŒ</span>
                    </div>
                  </div>
                  <div class="field-error" *ngIf="hasError('personalInfo.email')">
                    {{ getErrorMessage('personalInfo.email') }}
                  </div>
                  <div class="field-hint">é‚®ç®±ç”¨äºç™»å½•å’Œæ¥æ”¶é€šçŸ¥</div>
                </div>

                <!-- æ‰‹æœºå· -->
                <div class="form-field">
                  <label class="field-label required">æ‰‹æœºå·</label>
                  <input 
                    type="tel"
                    formControlName="phone"
                    class="form-input"
                    [class.error]="hasError('personalInfo.phone')"
                    placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·ç ">
                  <div class="field-error" *ngIf="hasError('personalInfo.phone')">
                    {{ getErrorMessage('personalInfo.phone') }}
                  </div>
                </div>

                <!-- èº«ä»½è¯å· -->
                <div class="form-field">
                  <label class="field-label required">èº«ä»½è¯å·</label>
                  <input 
                    type="text"
                    formControlName="idCard"
                    class="form-input"
                    [class.error]="hasError('personalInfo.idCard')"
                    placeholder="è¯·è¾“å…¥èº«ä»½è¯å·ç ">
                  <div class="field-error" *ngIf="hasError('personalInfo.idCard')">
                    {{ getErrorMessage('personalInfo.idCard') }}
                  </div>
                </div>

                <!-- å¹´é¾„ -->
                <div class="form-field">
                  <label class="field-label required">å¹´é¾„</label>
                  <input 
                    type="number"
                    formControlName="age"
                    class="form-input"
                    [class.error]="hasError('personalInfo.age')"
                    placeholder="è¯·è¾“å…¥å¹´é¾„"
                    min="16"
                    max="65">
                  <div class="field-error" *ngIf="hasError('personalInfo.age')">
                    {{ getErrorMessage('personalInfo.age') }}
                  </div>
                </div>

                <!-- æ€§åˆ« -->
                <div class="form-field">
                  <label class="field-label required">æ€§åˆ«</label>
                  <div class="radio-group">
                    <label class="radio-option">
                      <input type="radio" formControlName="gender" value="male">
                      <span class="radio-text">ç”·</span>
                    </label>
                    <label class="radio-option">
                      <input type="radio" formControlName="gender" value="female">
                      <span class="radio-text">å¥³</span>
                    </label>
                  </div>
                  <div class="field-error" *ngIf="hasError('personalInfo.gender')">
                    {{ getErrorMessage('personalInfo.gender') }}
                  </div>
                </div>

                <!-- ç”Ÿæ—¥ -->
                <div class="form-field">
                  <label class="field-label required">ç”Ÿæ—¥</label>
                  <input 
                    type="date"
                    formControlName="birthday"
                    class="form-input"
                    [class.error]="hasError('personalInfo.birthday')">
                  <div class="field-error" *ngIf="hasError('personalInfo.birthday')">
                    {{ getErrorMessage('personalInfo.birthday') }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- è´¦æˆ·ä¿¡æ¯éƒ¨åˆ† -->
          <div class="form-section">
            <div class="section-header">
              <h3>ğŸ” è´¦æˆ·ä¿¡æ¯</h3>
              <div class="section-status" [class.valid]="studentForm.get('accountInfo')?.valid">
                {{ studentForm.get('accountInfo')?.valid ? 'âœ…' : 'âŒ' }}
              </div>
            </div>

            <div formGroupName="accountInfo" class="form-group-container">
              <div class="form-grid">
                <!-- ç”¨æˆ·å -->
                <div class="form-field">
                  <label class="field-label required">ç”¨æˆ·å</label>
                  <input 
                    type="text"
                    formControlName="username"
                    class="form-input"
                    [class.error]="hasError('accountInfo.username')"
                    placeholder="3-20ä¸ªå­—ç¬¦ï¼Œæ”¯æŒå­—æ¯æ•°å­—ä¸‹åˆ’çº¿">
                  <div class="field-error" *ngIf="hasError('accountInfo.username')">
                    {{ getErrorMessage('accountInfo.username') }}
                  </div>
                </div>

                <!-- å¯†ç  -->
                <div class="form-field">
                  <label class="field-label required">å¯†ç </label>
                  <input 
                    type="password"
                    formControlName="password"
                    class="form-input"
                    [class.error]="hasError('accountInfo.password')"
                    placeholder="è¯·è¾“å…¥å¯†ç ">
                  <div class="password-strength" *ngIf="getFormControl('accountInfo.password')?.value">
                    <div class="strength-bar">
                      <div class="strength-fill" 
                           [style.width.%]="getPasswordStrength()"
                           [style.background-color]="getPasswordStrengthColor()"></div>
                    </div>
                    <span class="strength-text" [style.color]="getPasswordStrengthColor()">
                      {{ getPasswordStrengthText() }}
                    </span>
                  </div>
                  <div class="field-error" *ngIf="hasError('accountInfo.password')">
                    {{ getErrorMessage('accountInfo.password') }}
                  </div>
                  <div class="field-hint">å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼Œè‡³å°‘8ä½</div>
                </div>

                <!-- ç¡®è®¤å¯†ç  -->
                <div class="form-field">
                  <label class="field-label required">ç¡®è®¤å¯†ç </label>
                  <input 
                    type="password"
                    formControlName="confirmPassword"
                    class="form-input"
                    [class.error]="hasError('accountInfo.confirmPassword')"
                    placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                  <div class="field-error" *ngIf="hasError('accountInfo.confirmPassword')">
                    {{ getErrorMessage('accountInfo.confirmPassword') }}
                  </div>
                </div>

                <!-- å®‰å…¨é—®é¢˜ -->
                <div class="form-field">
                  <label class="field-label required">å®‰å…¨é—®é¢˜</label>
                  <select formControlName="securityQuestion" class="form-select" [class.error]="hasError('accountInfo.securityQuestion')">
                    <option value="">è¯·é€‰æ‹©å®‰å…¨é—®é¢˜</option>
                    <option value="pet">æ‚¨çš„ç¬¬ä¸€åªå® ç‰©å«ä»€ä¹ˆåå­—ï¼Ÿ</option>
                    <option value="school">æ‚¨çš„å°å­¦æ ¡åæ˜¯ä»€ä¹ˆï¼Ÿ</option>
                    <option value="teacher">æ‚¨æœ€å–œæ¬¢çš„è€å¸ˆå«ä»€ä¹ˆåå­—ï¼Ÿ</option>
                    <option value="city">æ‚¨çš„å‡ºç”ŸåŸå¸‚æ˜¯å“ªé‡Œï¼Ÿ</option>
                  </select>
                  <div class="field-error" *ngIf="hasError('accountInfo.securityQuestion')">
                    {{ getErrorMessage('accountInfo.securityQuestion') }}
                  </div>
                </div>

                <!-- å®‰å…¨ç­”æ¡ˆ -->
                <div class="form-field">
                  <label class="field-label required">å®‰å…¨ç­”æ¡ˆ</label>
                  <input 
                    type="text"
                    formControlName="securityAnswer"
                    class="form-input"
                    [class.error]="hasError('accountInfo.securityAnswer')"
                    placeholder="è¯·è¾“å…¥å®‰å…¨é—®é¢˜çš„ç­”æ¡ˆ">
                  <div class="field-error" *ngIf="hasError('accountInfo.securityAnswer')">
                    {{ getErrorMessage('accountInfo.securityAnswer') }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- å­¦ä¹ ä¿¡æ¯éƒ¨åˆ† -->
          <div class="form-section">
            <div class="section-header">
              <h3>ğŸ“ å­¦ä¹ ä¿¡æ¯</h3>
              <div class="section-status" [class.valid]="studentForm.get('academicInfo')?.valid">
                {{ studentForm.get('academicInfo')?.valid ? 'âœ…' : 'âŒ' }}
              </div>
            </div>

            <div formGroupName="academicInfo" class="form-group-container">
              <div class="form-grid">
                <!-- å¹´çº§ -->
                <div class="form-field">
                  <label class="field-label required">å¹´çº§</label>
                  <select formControlName="grade" class="form-select" [class.error]="hasError('academicInfo.grade')">
                    <option value="">è¯·é€‰æ‹©å¹´çº§</option>
                    <option *ngFor="let grade of gradeOptions" [value]="grade.value">
                      {{ grade.label }}
                    </option>
                  </select>
                  <div class="field-error" *ngIf="hasError('academicInfo.grade')">
                    {{ getErrorMessage('academicInfo.grade') }}
                  </div>
                </div>

                <!-- ä¸“ä¸š -->
                <div class="form-field">
                  <label class="field-label required">ä¸“ä¸š</label>
                  <input 
                    type="text"
                    formControlName="major"
                    class="form-input"
                    [class.error]="hasError('academicInfo.major')"
                    placeholder="è¯·è¾“å…¥ä¸“ä¸šåç§°">
                  <div class="field-error" *ngIf="hasError('academicInfo.major')">
                    {{ getErrorMessage('academicInfo.major') }}
                  </div>
                </div>

                <!-- GPA -->
                <div class="form-field">
                  <label class="field-label required">GPA</label>
                  <input 
                    type="number"
                    formControlName="gpa"
                    class="form-input"
                    [class.error]="hasError('academicInfo.gpa')"
                    placeholder="è¯·è¾“å…¥GPA (0-4)"
                    min="0"
                    max="4"
                    step="0.1">
                  <div class="field-error" *ngIf="hasError('academicInfo.gpa')">
                    {{ getErrorMessage('academicInfo.gpa') }}
                  </div>
                </div>

                <!-- å¥–å­¦é‡‘ -->
                <div class="form-field full-width">
                  <label class="checkbox-label">
                    <input type="checkbox" formControlName="hasScholarship">
                    <span class="checkbox-text">è·å¾—è¿‡å¥–å­¦é‡‘</span>
                  </label>
                </div>

                <!-- å¥–å­¦é‡‘é‡‘é¢ -->
                <div class="form-field" *ngIf="studentForm.get('academicInfo.hasScholarship')?.value">
                  <label class="field-label required">å¥–å­¦é‡‘é‡‘é¢</label>
                  <input 
                    type="number"
                    formControlName="scholarshipAmount"
                    class="form-input"
                    [class.error]="hasError('academicInfo.scholarshipAmount')"
                    placeholder="è¯·è¾“å…¥å¥–å­¦é‡‘é‡‘é¢"
                    min="1000">
                  <div class="field-error" *ngIf="hasError('academicInfo.scholarshipAmount')">
                    {{ getErrorMessage('academicInfo.scholarshipAmount') }}
                  </div>
                </div>
              </div>

              <!-- ç§‘ç›®æˆç»© -->
              <div class="subjects-section">
                <div class="subjects-header">
                  <h4>ğŸ“š ç§‘ç›®æˆç»©</h4>
                  <button type="button" class="btn btn-secondary" (click)="addSubject()">
                    â• æ·»åŠ ç§‘ç›®
                  </button>
                </div>
                
                <div formArrayName="subjects" class="subjects-list">
                  <div *ngFor="let subject of subjectsFormArray.controls; let i = index" 
                       [formGroupName]="i" 
                       class="subject-item">
                    <div class="subject-grid">
                      <div class="form-field">
                        <label class="field-label required">ç§‘ç›®</label>
                        <select formControlName="subject" class="form-select">
                          <option value="">è¯·é€‰æ‹©ç§‘ç›®</option>
                          <option *ngFor="let option of subjectOptions" [value]="option.value">
                            {{ option.label }}
                          </option>
                        </select>
                      </div>
                      
                      <div class="form-field">
                        <label class="field-label required">æˆç»©</label>
                        <input 
                          type="number"
                          formControlName="score"
                          class="form-input"
                          placeholder="0-100"
                          min="0"
                          max="100">
                      </div>
                      
                      <div class="form-field">
                        <label class="field-label required">å­¦åˆ†</label>
                        <input 
                          type="number"
                          formControlName="credit"
                          class="form-input"
                          placeholder="1-10"
                          min="1"
                          max="10">
                      </div>
                      
                      <div class="form-field">
                        <button type="button" class="btn btn-danger btn-small" (click)="removeSubject(i)">
                          ğŸ—‘ï¸ åˆ é™¤
                        </button>
                      </div>
                    </div>
                  </div>
                  
                  <div *ngIf="subjectsFormArray.length === 0" class="no-subjects">
                    <p>æš‚æ— ç§‘ç›®ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»"æ·»åŠ ç§‘ç›®"æŒ‰é’®æ·»åŠ </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- è”ç³»ä¿¡æ¯éƒ¨åˆ† -->
          <div class="form-section">
            <div class="section-header">
              <h3>ğŸ“ è”ç³»ä¿¡æ¯</h3>
              <div class="section-status" [class.valid]="studentForm.get('contactInfo')?.valid">
                {{ studentForm.get('contactInfo')?.valid ? 'âœ…' : 'âŒ' }}
              </div>
            </div>

            <div formGroupName="contactInfo" class="form-group-container">
              <!-- åœ°å€ä¿¡æ¯ -->
              <div class="subsection">
                <h4>ğŸ  åœ°å€ä¿¡æ¯</h4>
                <div formGroupName="address" class="form-grid">
                  <div class="form-field">
                    <label class="field-label required">å›½å®¶</label>
                    <input 
                      type="text"
                      formControlName="country"
                      class="form-input"
                      [class.error]="hasError('contactInfo.address.country')">
                    <div class="field-error" *ngIf="hasError('contactInfo.address.country')">
                      {{ getErrorMessage('contactInfo.address.country') }}
                    </div>
                  </div>

                  <div class="form-field">
                    <label class="field-label required">çœä»½</label>
                    <input 
                      type="text"
                      formControlName="province"
                      class="form-input"
                      [class.error]="hasError('contactInfo.address.province')"
                      placeholder="è¯·è¾“å…¥çœä»½">
                    <div class="field-error" *ngIf="hasError('contactInfo.address.province')">
                      {{ getErrorMessage('contactInfo.address.province') }}
                    </div>
                  </div>

                  <div class="form-field">
                    <label class="field-label required">åŸå¸‚</label>
                    <input 
                      type="text"
                      formControlName="city"
                      class="form-input"
                      [class.error]="hasError('contactInfo.address.city')"
                      placeholder="è¯·è¾“å…¥åŸå¸‚">
                    <div class="field-error" *ngIf="hasError('contactInfo.address.city')">
                      {{ getErrorMessage('contactInfo.address.city') }}
                    </div>
                  </div>

                  <div class="form-field">
                    <label class="field-label required">è¯¦ç»†åœ°å€</label>
                    <input 
                      type="text"
                      formControlName="street"
                      class="form-input"
                      [class.error]="hasError('contactInfo.address.street')"
                      placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€">
                    <div class="field-error" *ngIf="hasError('contactInfo.address.street')">
                      {{ getErrorMessage('contactInfo.address.street') }}
                    </div>
                  </div>

                  <div class="form-field">
                    <label class="field-label required">é‚®æ”¿ç¼–ç </label>
                    <input 
                      type="text"
                      formControlName="zipCode"
                      class="form-input"
                      [class.error]="hasError('contactInfo.address.zipCode')"
                      placeholder="è¯·è¾“å…¥6ä½é‚®æ”¿ç¼–ç ">
                    <div class="field-error" *ngIf="hasError('contactInfo.address.zipCode')">
                      {{ getErrorMessage('contactInfo.address.zipCode') }}
                    </div>
                  </div>
                </div>
              </div>

              <!-- ç´§æ€¥è”ç³»äºº -->
              <div class="subsection">
                <h4>ğŸš¨ ç´§æ€¥è”ç³»äºº</h4>
                <div formGroupName="emergencyContact" class="form-grid">
                  <div class="form-field">
                    <label class="field-label required">å§“å</label>
                    <input 
                      type="text"
                      formControlName="name"
                      class="form-input"
                      [class.error]="hasError('contactInfo.emergencyContact.name')"
                      placeholder="è¯·è¾“å…¥è”ç³»äººå§“å">
                    <div class="field-error" *ngIf="hasError('contactInfo.emergencyContact.name')">
                      {{ getErrorMessage('contactInfo.emergencyContact.name') }}
                    </div>
                  </div>

                  <div class="form-field">
                    <label class="field-label required">å…³ç³»</label>
                    <select formControlName="relationship" class="form-select" [class.error]="hasError('contactInfo.emergencyContact.relationship')">
                      <option value="">è¯·é€‰æ‹©å…³ç³»</option>
                      <option value="çˆ¶äº²">çˆ¶äº²</option>
                      <option value="æ¯äº²">æ¯äº²</option>
                      <option value="é…å¶">é…å¶</option>
                      <option value="å…„å¼Ÿ">å…„å¼Ÿ</option>
                      <option value="å§å¦¹">å§å¦¹</option>
                      <option value="æœ‹å‹">æœ‹å‹</option>
                    </select>
                    <div class="field-error" *ngIf="hasError('contactInfo.emergencyContact.relationship')">
                      {{ getErrorMessage('contactInfo.emergencyContact.relationship') }}
                    </div>
                  </div>

                  <div class="form-field">
                    <label class="field-label required">ç”µè¯</label>
                    <input 
                      type="tel"
                      formControlName="phone"
                      class="form-input"
                      [class.error]="hasError('contactInfo.emergencyContact.phone')"
                      placeholder="è¯·è¾“å…¥è”ç³»äººç”µè¯">
                    <div class="field-error" *ngIf="hasError('contactInfo.emergencyContact.phone')">
                      {{ getErrorMessage('contactInfo.emergencyContact.phone') }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- åå¥½è®¾ç½®éƒ¨åˆ† -->
          <div class="form-section">
            <div class="section-header">
              <h3>âš™ï¸ åå¥½è®¾ç½®</h3>
              <div class="section-status" [class.valid]="studentForm.get('preferences')?.valid">
                {{ studentForm.get('preferences')?.valid ? 'âœ…' : 'âŒ' }}
              </div>
            </div>

            <div formGroupName="preferences" class="form-group-container">
              <div class="form-grid">
                <!-- è®¢é˜…é€‰é¡¹ -->
                <div class="form-field full-width">
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input type="checkbox" formControlName="newsletter">
                      <span class="checkbox-text">è®¢é˜…é‚®ä»¶é€šçŸ¥</span>
                    </label>
                    <label class="checkbox-label">
                      <input type="checkbox" formControlName="notifications">
                      <span class="checkbox-text">æ¥æ”¶ç³»ç»Ÿé€šçŸ¥</span>
                    </label>
                  </div>
                </div>

                <!-- ä¸»é¢˜è®¾ç½® -->
                <div class="form-field">
                  <label class="field-label">ä¸»é¢˜</label>
                  <div class="radio-group">
                    <label class="radio-option">
                      <input type="radio" formControlName="theme" value="light">
                      <span class="radio-text">æµ…è‰²</span>
                    </label>
                    <label class="radio-option">
                      <input type="radio" formControlName="theme" value="dark">
                      <span class="radio-text">æ·±è‰²</span>
                    </label>
                  </div>
                </div>

                <!-- è¯­è¨€è®¾ç½® -->
                <div class="form-field">
                  <label class="field-label">è¯­è¨€</label>
                  <select formControlName="language" class="form-select">
                    <option value="zh">ç®€ä½“ä¸­æ–‡</option>
                    <option value="en">English</option>
                  </select>
                </div>

                <!-- å¤‡æ³¨ -->
                <div class="form-field full-width">
                  <label class="field-label">å¤‡æ³¨</label>
                  <textarea 
                    formControlName="comments"
                    class="form-textarea"
                    [class.error]="hasError('preferences.comments')"
                    placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
                    rows="4"></textarea>
                  <div class="field-error" *ngIf="hasError('preferences.comments')">
                    {{ getErrorMessage('preferences.comments') }}
                  </div>
                  <div class="char-count">
                    {{ getFormControl('preferences.comments')?.value?.length || 0 }}/500
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- è¡¨å•æ“ä½œæŒ‰é’® -->
          <div class="form-actions">
            <button 
              type="submit" 
              class="btn btn-primary btn-large"
              [disabled]="studentForm.invalid || isSubmitting">
              <span *ngIf="isSubmitting" class="loading-spinner"></span>
              {{ isSubmitting ? 'æäº¤ä¸­...' : 'æäº¤è¡¨å•' }}
            </button>
            <button 
              type="button" 
              class="btn btn-secondary btn-large"
              (click)="resetReactiveForm()">
              ğŸ”„ é‡ç½®è¡¨å•
            </button>
          </div>
        </form>

        <!-- æäº¤ç»“æœæ˜¾ç¤º -->
        <div *ngIf="submittedData" class="submission-result">
          <h3>âœ… è¡¨å•æäº¤æˆåŠŸï¼</h3>
          <div class="result-data">
            <h4>æäº¤çš„æ•°æ®ï¼š</h4>
            <pre>{{ submittedData | json }}</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- æ¨¡æ¿é©±åŠ¨è¡¨å•æ ‡ç­¾é¡µ -->
    <div class="tab-content" *ngIf="activeTab === 'template'">
      <div class="form-container">
        <h3>ğŸ“‹ æ¨¡æ¿é©±åŠ¨è¡¨å•éªŒè¯ç¤ºä¾‹</h3>
        <p class="form-description">
          æ¼”ç¤ºæ¨¡æ¿é©±åŠ¨è¡¨å•çš„éªŒè¯åŠŸèƒ½ï¼ŒåŒ…æ‹¬å†…ç½®éªŒè¯å™¨å’Œè‡ªå®šä¹‰éªŒè¯ã€‚
        </p>

        <form #templateForm="ngForm" (ngSubmit)="onSubmitTemplateForm(templateForm)" class="template-form">
          <div class="form-section">
            <div class="form-grid">
              <!-- ç”¨æˆ·å -->
              <div class="form-field">
                <label class="field-label required">ç”¨æˆ·å</label>
                <input 
                  type="text"
                  name="username"
                  [(ngModel)]="templateFormData.username"
                  #usernameField="ngModel"
                  required
                  minlength="3"
                  maxlength="20"
                  class="form-input"
                  [class.error]="usernameField.invalid && (usernameField.dirty || usernameField.touched)"
                  placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                <div class="field-error" *ngIf="usernameField.invalid && (usernameField.dirty || usernameField.touched)">
                  <span *ngIf="usernameField.errors?.['required']">ç”¨æˆ·åä¸ºå¿…å¡«é¡¹</span>
                  <span *ngIf="usernameField.errors?.['minlength']">ç”¨æˆ·åè‡³å°‘éœ€è¦3ä¸ªå­—ç¬¦</span>
                  <span *ngIf="usernameField.errors?.['maxlength']">ç”¨æˆ·åæœ€å¤š20ä¸ªå­—ç¬¦</span>
                </div>
              </div>

              <!-- é‚®ç®± -->
              <div class="form-field">
                <label class="field-label required">é‚®ç®±</label>
                <input 
                  type="email"
                  name="email"
                  [(ngModel)]="templateFormData.email"
                  #emailField="ngModel"
                  required
                  email
                  class="form-input"
                  [class.error]="emailField.invalid && (emailField.dirty || emailField.touched)"
                  placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€">
                <div class="field-error" *ngIf="emailField.invalid && (emailField.dirty || emailField.touched)">
                  <span *ngIf="emailField.errors?.['required']">é‚®ç®±ä¸ºå¿…å¡«é¡¹</span>
                  <span *ngIf="emailField.errors?.['email']">è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€</span>
                </div>
              </div>

              <!-- æ‰‹æœºå· -->
              <div class="form-field">
                <label class="field-label required">æ‰‹æœºå·</label>
                <input 
                  type="tel"
                  name="phone"
                  [(ngModel)]="templateFormData.phone"
                  #phoneField="ngModel"
                  required
                  pattern="^1[3-9]\d{9}$"
                  class="form-input"
                  [class.error]="phoneField.invalid && (phoneField.dirty || phoneField.touched)"
                  placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·ç ">
                <div class="field-error" *ngIf="phoneField.invalid && (phoneField.dirty || phoneField.touched)">
                  <span *ngIf="phoneField.errors?.['required']">æ‰‹æœºå·ä¸ºå¿…å¡«é¡¹</span>
                  <span *ngIf="phoneField.errors?.['pattern']">è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç </span>
                </div>
              </div>

              <!-- ç•™è¨€ -->
              <div class="form-field full-width">
                <label class="field-label">ç•™è¨€</label>
                <textarea 
                  name="message"
                  [(ngModel)]="templateFormData.message"
                  #messageField="ngModel"
                  maxlength="200"
                  class="form-textarea"
                  placeholder="è¯·è¾“å…¥ç•™è¨€å†…å®¹ï¼ˆå¯é€‰ï¼‰"
                  rows="4"></textarea>
                <div class="char-count">
                  {{ templateFormData.message.length }}/200
                </div>
              </div>

              <!-- åè®®åŒæ„ -->
              <div class="form-field full-width">
                <label class="checkbox-label">
                  <input 
                    type="checkbox"
                    name="agreement"
                    [(ngModel)]="templateFormData.agreement"
                    #agreementField="ngModel"
                    required>
                  <span class="checkbox-text">æˆ‘å·²é˜…è¯»å¹¶åŒæ„ç”¨æˆ·åè®®</span>
                </label>
                <div class="field-error" *ngIf="agreementField.invalid && (agreementField.dirty || agreementField.touched)">
                  <span *ngIf="agreementField.errors?.['required']">å¿…é¡»åŒæ„ç”¨æˆ·åè®®æ‰èƒ½æäº¤</span>
                </div>
              </div>
            </div>
          </div>

          <!-- è¡¨å•çŠ¶æ€æ˜¾ç¤º -->
          <div class="form-status">
            <div class="status-item">
              <span class="status-label">è¡¨å•çŠ¶æ€:</span>
              <span class="status-value" [class.valid]="templateForm.valid" [class.invalid]="templateForm.invalid">
                {{ templateForm.valid ? 'âœ… æœ‰æ•ˆ' : 'âŒ æ— æ•ˆ' }}
              </span>
            </div>
            <div class="status-item">
              <span class="status-label">æ˜¯å¦è¢«è§¦æ‘¸:</span>
              <span class="status-value">{{ templateForm.touched ? 'æ˜¯' : 'å¦' }}</span>
            </div>
            <div class="status-item">
              <span class="status-label">æ˜¯å¦è¢«ä¿®æ”¹:</span>
              <span class="status-value">{{ templateForm.dirty ? 'æ˜¯' : 'å¦' }}</span>
            </div>
          </div>

          <!-- è¡¨å•æ“ä½œæŒ‰é’® -->
          <div class="form-actions">
            <button 
              type="submit" 
              class="btn btn-primary btn-large"
              [disabled]="templateForm.invalid">
              ğŸ“¤ æäº¤è¡¨å•
            </button>
            <button 
              type="button" 
              class="btn btn-secondary btn-large"
              (click)="resetTemplateForm(templateForm)">
              ğŸ”„ é‡ç½®è¡¨å•
            </button>
          </div>
        </form>

        <!-- æ¨¡æ¿è¡¨å•æäº¤ç»“æœ -->
        <div *ngIf="templateSubmittedData" class="submission-result">
          <h3>âœ… æ¨¡æ¿è¡¨å•æäº¤æˆåŠŸï¼</h3>
          <div class="result-data">
            <h4>æäº¤çš„æ•°æ®ï¼š</h4>
            <pre>{{ templateSubmittedData | json }}</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- ç†è®ºä¸æœ€ä½³å®è·µæ ‡ç­¾é¡µ -->
    <div class="tab-content" *ngIf="activeTab === 'theory'">
      <div class="theory-container">
        <div class="theory-section">
          <h3>ğŸ“š è¡¨å•éªŒè¯ç†è®º</h3>
          
          <div class="theory-card">
            <h4>ğŸ¯ å“åº”å¼è¡¨å• vs æ¨¡æ¿é©±åŠ¨è¡¨å•</h4>
            <div class="comparison-table">
              <table>
                <thead>
                  <tr>
                    <th>ç‰¹æ€§</th>
                    <th>å“åº”å¼è¡¨å•</th>
                    <th>æ¨¡æ¿é©±åŠ¨è¡¨å•</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>æ•°æ®æ¨¡å‹</td>
                    <td>æ˜¾å¼ï¼Œåœ¨ç»„ä»¶ç±»ä¸­å®šä¹‰</td>
                    <td>éšå¼ï¼Œç”±æŒ‡ä»¤åˆ›å»º</td>
                  </tr>
                  <tr>
                    <td>æ•°æ®æµ</td>
                    <td>åŒæ­¥</td>
                    <td>å¼‚æ­¥</td>
                  </tr>
                  <tr>
                    <td>è¡¨å•éªŒè¯</td>
                    <td>å‡½æ•°</td>
                    <td>æŒ‡ä»¤</td>
                  </tr>
                  <tr>
                    <td>ä¸å¯å˜æ€§</td>
                    <td>ä¸å¯å˜</td>
                    <td>å¯å˜</td>
                  </tr>
                  <tr>
                    <td>å¯ä¼¸ç¼©æ€§</td>
                    <td>è®¿é—®åº•å±‚APIï¼Œå¯ä¼¸ç¼©æ€§æ›´é«˜</td>
                    <td>åªèƒ½é€šè¿‡æŒ‡ä»¤è®¿é—®</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="theory-card">
            <h4>âœ¨ éªŒè¯å™¨ç±»å‹</h4>
            <div class="validators-grid">
              <div class="validator-item">
                <h5>å†…ç½®éªŒè¯å™¨</h5>
                <ul>
                  <li><code>Validators.required</code> - å¿…å¡«éªŒè¯</li>
                  <li><code>Validators.email</code> - é‚®ç®±æ ¼å¼éªŒè¯</li>
                  <li><code>Validators.minLength</code> - æœ€å°é•¿åº¦éªŒè¯</li>
                  <li><code>Validators.maxLength</code> - æœ€å¤§é•¿åº¦éªŒè¯</li>
                  <li><code>Validators.pattern</code> - æ­£åˆ™è¡¨è¾¾å¼éªŒè¯</li>
                  <li><code>Validators.min/max</code> - æ•°å€¼èŒƒå›´éªŒè¯</li>
                </ul>
              </div>
              
              <div class="validator-item">
                <h5>è‡ªå®šä¹‰éªŒè¯å™¨</h5>
                <ul>
                  <li>åŒæ­¥éªŒè¯å™¨ - ç«‹å³è¿”å›éªŒè¯ç»“æœ</li>
                  <li>å¼‚æ­¥éªŒè¯å™¨ - è¿”å›Promiseæˆ–Observable</li>
                  <li>è·¨å­—æ®µéªŒè¯å™¨ - éªŒè¯å¤šä¸ªå­—æ®µä¹‹é—´çš„å…³ç³»</li>
                  <li>æ¡ä»¶éªŒè¯å™¨ - æ ¹æ®æ¡ä»¶åŠ¨æ€åº”ç”¨éªŒè¯</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="theory-card">
            <h4>ğŸ† æœ€ä½³å®è·µ</h4>
            <div class="best-practices">
              <div class="practice-item">
                <div class="practice-icon">ğŸ’¡</div>
                <div class="practice-content">
                  <h5>ç”¨æˆ·ä½“éªŒä¼˜å…ˆ</h5>
                  <p>éªŒè¯é”™è¯¯ä¿¡æ¯åº”è¯¥æ¸…æ™°ã€å‹å¥½ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£å¦‚ä½•ä¿®æ­£é”™è¯¯</p>
                </div>
              </div>
              
              <div class="practice-item">
                <div class="practice-icon">âš¡</div>
                <div class="practice-content">
                  <h5>å®æ—¶éªŒè¯</h5>
                  <p>åœ¨ç”¨æˆ·è¾“å…¥æ—¶æä¾›å³æ—¶åé¦ˆï¼Œè€Œä¸æ˜¯ç­‰åˆ°æäº¤æ—¶æ‰æ˜¾ç¤ºé”™è¯¯</p>
                </div>
              </div>
              
              <div class="practice-item">
                <div class="practice-icon">ğŸ”’</div>
                <div class="practice-content">
                  <h5>å‰åç«¯éªŒè¯</h5>
                  <p>å‰ç«¯éªŒè¯æå‡ç”¨æˆ·ä½“éªŒï¼Œåç«¯éªŒè¯ç¡®ä¿æ•°æ®å®‰å…¨</p>
                </div>
              </div>
              
              <div class="practice-item">
                <div class="practice-icon">ğŸ¨</div>
                <div class="practice-content">
                  <h5>è§†è§‰åé¦ˆ</h5>
                  <p>ä½¿ç”¨é¢œè‰²ã€å›¾æ ‡ç­‰è§†è§‰å…ƒç´ æ˜ç¡®è¡¨ç¤ºéªŒè¯çŠ¶æ€</p>
                </div>
              </div>
              
              <div class="practice-item">
                <div class="practice-icon">ğŸ“±</div>
                <div class="practice-content">
                  <h5>å“åº”å¼è®¾è®¡</h5>
                  <p>ç¡®ä¿è¡¨å•åœ¨å„ç§è®¾å¤‡ä¸Šéƒ½èƒ½æ­£å¸¸å·¥ä½œå’Œæ˜¾ç¤º</p>
                </div>
              </div>
              
                              <div class="practice-item">
                <div class="practice-icon">â™¿</div>
                <div class="practice-content">
                  <h5>æ— éšœç¢è®¿é—®</h5>
                  <p>æ”¯æŒé”®ç›˜å¯¼èˆªï¼Œæä¾›é€‚å½“çš„ARIAæ ‡ç­¾</p>
                </div>
              </div>
            </div>
          </div>

          <div class="theory-card">
            <h4>ğŸ”§ ä»£ç ç¤ºä¾‹</h4>
            <div class="code-examples">
              <div class="code-example">
                <h5>è‡ªå®šä¹‰éªŒè¯å™¨ç¤ºä¾‹</h5>
                <pre><code>// å¯†ç å¼ºåº¦éªŒè¯å™¨
static passwordStrength(control: AbstractControl): ValidationErrors | null {{ '{' }}
  const value = control.value;
  if (!value) return null;

  const hasNumber = /[0-9]/.test(value);
  const hasLowercase = /[a-z]/.test(value);
  const hasUppercase = /[A-Z]/.test(value);
  const hasSpecial = /[!#$%^&*(),.?":{{ '{' }}{{ '}' }}|&lt;&gt;]/.test(value);
  const isValidLength = value.length &gt;= 8;

  const passwordValid = hasNumber && hasLowercase && 
                        hasUppercase && hasSpecial && isValidLength;

  return passwordValid ? null : {{ '{' }}
    passwordStrength: {{ '{' }}
      hasNumber, hasLowercase, hasUppercase, hasSpecial, isValidLength
    {{ '}' }}
  {{ '}' }};
{{ '}' }}</code></pre>
              </div>

              <div class="code-example">
                <h5>å¼‚æ­¥éªŒè¯å™¨ç¤ºä¾‹</h5>
                <pre><code>// å¼‚æ­¥é‚®ç®±éªŒè¯å™¨
static asyncEmailValidator(control: AbstractControl): Promise&lt;ValidationErrors | null&gt; {{ '{' }}
  return new Promise((resolve) =&gt; {{ '{' }}
    setTimeout(() =&gt; {{ '{' }}
      const existingEmails = ['', ''];
      if (existingEmails.includes(control.value)) {{ '{' }}
        resolve({{ '{' }} emailExists: true {{ '}' }});
      {{ '}' }} else {{ '{' }}
        resolve(null);
      {{ '}' }}
    {{ '}' }}, 1000);
  {{ '}' }});
{{ '}' }}</code></pre>
              </div>

              <div class="code-example">
                <h5>è·¨å­—æ®µéªŒè¯å™¨ç¤ºä¾‹</h5>
                <pre><code>// ç¡®è®¤å¯†ç éªŒè¯å™¨
static confirmPassword(passwordField: string) {{ '{' }}
  return (control: AbstractControl): ValidationErrors | null =&gt; {{ '{' }}
    if (!control.parent) return null;
    const password = control.parent.get(passwordField);
    const confirmPassword = control;
    
    if (password && confirmPassword && 
        password.value !== confirmPassword.value) {{ '{' }}
      return {{ '{' }} confirmPassword: true {{ '}' }};
    {{ '}' }}
    return null;
  {{ '}' }};
{{ '}' }}</code></pre>
              </div>
            </div>
          </div>

          <div class="theory-card">
            <h4>ğŸ“Š è¡¨å•çŠ¶æ€ç®¡ç†</h4>
            <div class="form-states">
              <div class="state-item">
                <div class="state-header">
                  <span class="state-icon">ğŸ”„</span>
                  <h5>pristine / dirty</h5>
                </div>
                <p>è¡¨ç¤ºè¡¨å•æ˜¯å¦è¢«ç”¨æˆ·ä¿®æ”¹è¿‡ã€‚pristineè¡¨ç¤ºæœªä¿®æ”¹ï¼Œdirtyè¡¨ç¤ºå·²ä¿®æ”¹ã€‚</p>
              </div>

              <div class="state-item">
                <div class="state-header">
                  <span class="state-icon">ğŸ‘†</span>
                  <h5>touched / untouched</h5>
                </div>
                <p>è¡¨ç¤ºç”¨æˆ·æ˜¯å¦ä¸è¡¨å•æ§ä»¶äº¤äº’è¿‡ã€‚touchedè¡¨ç¤ºå·²äº¤äº’ï¼Œuntouchedè¡¨ç¤ºæœªäº¤äº’ã€‚</p>
              </div>

              <div class="state-item">
                <div class="state-header">
                  <span class="state-icon">âœ…</span>
                  <h5>valid / invalid</h5>
                </div>
                <p>è¡¨ç¤ºè¡¨å•æ§ä»¶çš„éªŒè¯çŠ¶æ€ã€‚validè¡¨ç¤ºé€šè¿‡éªŒè¯ï¼Œinvalidè¡¨ç¤ºéªŒè¯å¤±è´¥ã€‚</p>
              </div>

              <div class="state-item">
                <div class="state-header">
                  <span class="state-icon">â³</span>
                  <h5>pending</h5>
                </div>
                <p>è¡¨ç¤ºå¼‚æ­¥éªŒè¯æ­£åœ¨è¿›è¡Œä¸­ã€‚åœ¨å¼‚æ­¥éªŒè¯å®Œæˆå‰ï¼Œæ§ä»¶å¤„äºpendingçŠ¶æ€ã€‚</p>
              </div>
            </div>
          </div>

          <div class="theory-card">
            <h4>ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
            <div class="performance-tips">
              <div class="tip-item">
                <span class="tip-number">1</span>
                <div class="tip-content">
                  <h5>ä½¿ç”¨OnPushå˜æ›´æ£€æµ‹ç­–ç•¥</h5>
                  <p>å¯¹äºå¤æ‚è¡¨å•ï¼Œä½¿ç”¨OnPushç­–ç•¥å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½</p>
                </div>
              </div>

              <div class="tip-item">
                <span class="tip-number">2</span>
                <div class="tip-content">
                  <h5>åˆç†ä½¿ç”¨å¼‚æ­¥éªŒè¯å™¨</h5>
                  <p>æ·»åŠ é€‚å½“çš„é˜²æŠ–å»¶è¿Ÿï¼Œé¿å…é¢‘ç¹çš„æœåŠ¡å™¨è¯·æ±‚</p>
                </div>
              </div>

              <div class="tip-item">
                <span class="tip-number">3</span>
                <div class="tip-content">
                  <h5>ä½¿ç”¨trackByå‡½æ•°</h5>
                  <p>åœ¨FormArrayä¸­ä½¿ç”¨trackByå‡½æ•°ä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“æ€§èƒ½</p>
                </div>
              </div>

              <div class="tip-item">
                <span class="tip-number">4</span>
                <div class="tip-content">
                  <h5>æ‡’åŠ è½½éªŒè¯</h5>
                  <p>å¯¹äºå¤æ‚éªŒè¯é€»è¾‘ï¼Œå¯ä»¥è€ƒè™‘åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰åŠ è½½éªŒè¯å™¨</p>
                </div>
              </div>
            </div>
          </div>

          <div class="theory-card">
            <h4>ğŸ” è°ƒè¯•æŠ€å·§</h4>
            <div class="debug-tips">
              <div class="debug-item">
                <h5>ğŸ’» å¼€å‘å·¥å…·</h5>
                <ul>
                  <li>ä½¿ç”¨Angular DevToolsæŸ¥çœ‹è¡¨å•çŠ¶æ€</li>
                  <li>åœ¨ç»„ä»¶ä¸­æ·»åŠ æ—¥å¿—è¾“å‡ºè°ƒè¯•éªŒè¯é€»è¾‘</li>
                  <li>ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹DOMçŠ¶æ€</li>
                </ul>
              </div>

              <div class="debug-item">
                <h5>ğŸ“ å¸¸è§é—®é¢˜</h5>
                <ul>
                  <li>éªŒè¯å™¨æ²¡æœ‰è§¦å‘ï¼šæ£€æŸ¥æ˜¯å¦æ­£ç¡®ç»‘å®šåˆ°FormControl</li>
                  <li>å¼‚æ­¥éªŒè¯å™¨ä¸å·¥ä½œï¼šç¡®ä¿è¿”å›Promiseæˆ–Observable</li>
                  <li>é”™è¯¯ä¿¡æ¯ä¸æ˜¾ç¤ºï¼šæ£€æŸ¥é”™è¯¯æ˜¾ç¤ºçš„æ¡ä»¶é€»è¾‘</li>
                  <li>è¡¨å•ä¸æäº¤ï¼šéªŒè¯è¡¨å•çš„validçŠ¶æ€</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>